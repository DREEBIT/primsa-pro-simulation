{"version":3,"sources":["../../../lib/api/recording/api-recorder.js"],"names":["recordingStore","isRecordingActive","isNotRecordingApiPath","apiUrl","path","indexOf","startNewRecording","uuid","stopRecording","recording","Object","keys","length","apiRecorder","req","res","next","forEach","recordUuid","push","url","baseUrl","method","params","body"],"mappings":";;;;;;;AAAA;;;;;;AAEA,MAAMA,iBAAiB,EAAvB;AACA,IAAIC,oBAAoB,KAAxB;;AAEA,MAAMC,wBAAwB,CAACC,MAAD,EAASC,IAAT,KAAkB;AAC9C,SAAOA,KAAKC,OAAL,CAAc,GAAEF,MAAO,aAAvB,MAAyC,CAAC,CAAjD;AACD,CAFD;;AAIO,MAAMG,gDAAoB,MAAM;AACrC,QAAMC,OAAO,kBAAb;AACAP,iBAAeO,IAAf,IAAuB,EAAvB;AACAN,sBAAoB,IAApB;AACA,SAAOM,IAAP;AACD,CALM;;AAOA,MAAMC,wCAAgBD,QAAQ;AACnC,QAAME,YAAYT,eAAeO,IAAf,CAAlB;AACA,SAAOP,eAAeO,IAAf,CAAP;AACAN,sBAAoBS,OAAOC,IAAP,CAAYX,cAAZ,EAA4BY,MAA5B,GAAqC,CAAzD;AACA,SAAOH,SAAP;AACD,CALM;;AAOA,MAAMI,oCAAcV,UAAU;AACnC,SAAO,CAACW,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AACzB,QAAIf,qBAAqBC,sBAAsBC,MAAtB,EAA8BW,IAAIV,IAAlC,CAAzB,EAAkE;AAChEM,aAAOC,IAAP,CAAYX,cAAZ,EAA4BiB,OAA5B,CAAoCC,cAAc;AAChDlB,uBAAekB,UAAf,EAA2BC,IAA3B,CAAgC;AAC9BC,eAAKN,IAAIO,OADqB;AAE9BjB,gBAAMU,IAAIV,IAFoB;AAG9BkB,kBAAQR,IAAIQ,MAHkB;AAI9BC,kBAAQT,IAAIS,MAJkB;AAK9BC,gBAAMV,IAAIU;AALoB,SAAhC;AAOD,OARD;AASD;;AAEDR;AACD,GAdD;AAeD,CAhBM","file":"api-recorder.js","sourcesContent":["import uuidv1 from 'uuid/v1';\n\nconst recordingStore = {};\nlet isRecordingActive = false;\n\nconst isNotRecordingApiPath = (apiUrl, path) => {\n  return path.indexOf(`${apiUrl}/recording/`) === -1;\n};\n\nexport const startNewRecording = () => {\n  const uuid = uuidv1();\n  recordingStore[uuid] = [];\n  isRecordingActive = true;\n  return uuid;\n};\n\nexport const stopRecording = uuid => {\n  const recording = recordingStore[uuid];\n  delete recordingStore[uuid];\n  isRecordingActive = Object.keys(recordingStore).length > 0;\n  return recording;\n};\n\nexport const apiRecorder = apiUrl => {\n  return (req, res, next) => {\n    if (isRecordingActive && isNotRecordingApiPath(apiUrl, req.path)) {\n      Object.keys(recordingStore).forEach(recordUuid => {\n        recordingStore[recordUuid].push({\n          url: req.baseUrl,\n          path: req.path,\n          method: req.method,\n          params: req.params,\n          body: req.body\n        });\n      });\n    }\n\n    next();\n  };\n};\n"]}